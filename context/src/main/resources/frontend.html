<!doctype html>
<html>
<head>
    <title>X-Game Frontend</title>
    <meta charset='utf-8'/>

</head>
<body>
<img src="http://cdn.droidtune.com/wp-content/uploads/2013/01/%D0%A2%D0%B0%D0%BD%D1%87%D0%B8%D0%BA%D0%B8-1990-android.png"
     style="display: none"
     id="tank"/>
<canvas width='640' height='480' id='screen'></canvas>
<script>
    var screen = document.getElementById("screen");
    var g = screen.getContext('2d');
    //g.fillStyle = "#ffffff";
    g.strokeStyle = "#df4b26";
    g.beginPath();
    g.moveTo(0, 0);
    g.lineTo(screen.width, screen.height);
    g.stroke();


    // создать подключение
    var socket = new WebSocket("ws://localhost:8081");

    function sendOK() {

    }

    // обработчик входящих сообщений
    socket.onmessage = function (event) {
        var resp = JSON.parse(event.data);
        console.info("Rendering: " + event.data.length);

        var screen = document.getElementById("screen");
        var g = screen.getContext('2d');
        g.save();
        g.scale(20.0, 20);
        //g.translate(1, 1);
        var totalPrinted = 0;
        resp.nested.forEach(function (e) {
            if (e.domain.xy && e.domain.texture) {
                var texture = e.domain.texture.texture;
                var x = e.domain.xy.x;
                var y = e.domain.xy.y;
                if (texture == 'Soil') {
                    g.strokeStyle = "Brown";
                } else if (texture == 'Water') {
                    g.strokeStyle = "Blue";
                } else if (texture == 'Sand') {
                    g.strokeStyle = "Yellow";
                } else {
                    g.strokeStyle = 'Gray';
                }
                g.fillStyle = g.strokeStyle;
                g.fillRect(x, y, 1, 1);
                console.log(x, y);
                totalPrinted+=1;
            }

        });
        console.log("restore", totalPrinted);
        g.restore();


        //socket.send(event.data);
//        setTimeout(function(){
//            socket.send(event.data);
//        }, 500);
    };
</script>
</body>
</html>